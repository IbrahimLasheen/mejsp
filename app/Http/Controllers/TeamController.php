<?php namespace App\Http\Controllers;use App\Models\Journals;use App\Models\Team;use Illuminate\Http\Request;class TeamController extends Controller{const PATH="assets/uploads/team/";const IMG_EXT='.webp';public function index(){$team=Team::orderBy('id','DESC')->get();return view('admin.team.all',compact('team'));}public function create(){$journals=Journals::select("name",'id')->get();return view('admin.team.create',compact('journals'));}public function store(Request $request){$request->validate(['name'=>'required|max:150','job'=>'required|max:150','image'=>'required|mimes:jpeg,jpg,png,webp|max:5120','type'=>'required|in:expert,editor','email'=>'nullable|max:150','country'=>'required|max:150','website'=>'nullable|max:255','twitter'=>'nullable|max:255','journal'=>'required']);$image=$request->image;$fileName=randomName(self::IMG_EXT);$insert=Team::create(['name'=>$request->name,'job'=>$request->job,'image'=>$fileName,'type'=>$request->type,'email'=>$request->email,'linkedin'=>$request->linkedin,'country'=>$request->country,'website'=>$request->website,'journal_id'=>$request->journal,]);if($insert->save()){image($image,self::PATH,$fileName,320,320);return response(['status'=>true,'message'=>'تم اضافة العضو بنجاح','form'=>'reset']);}}public function edit(Team $team,$id){$row=Team::find($id);if(!empty($row)){$journals=Journals::select("name",'id')->get();return view('admin.team.edit',compact('row','journals'));}else{return redirect(adminUrl('team'));}}public function update(Request $request,Team $team){$id=$request->id;$row=Team::find($id);if(!empty($row)){$request->validate(['name'=>'required|max:150','job'=>'required|max:150','image'=>'nullable|mimes:jpeg,jpg,png,webp|max:5120','type'=>'required|in:expert,editor','email'=>'nullable|max:150','country'=>'required|max:150','website'=>'nullable|max:255','linkedin'=>'nullable|max:255','journal'=>'required']);$row->name=$request->name;$row->job=$request->job;$row->type=$request->type;$row->email=$request->email;$row->linkedin=$request->linkedin;$row->journal_id=$request->journal;$row->website=$request->website;$row->country=$request->country;if($request->hasFile('image')){@unlink(self::PATH.$row->image);$imgName=randomName(self::IMG_EXT);$row->image=$imgName;$image=$request->image;}if($row->save()){if($request->hasFile('image')){image($image,self::PATH,$row->image,320,320);}return response(['status'=>true,'message'=>'تم تحديث البيانات بنجاح']);}}else{return response(['status'=>'notfound','message'=>'هذه البيانات لم تعد متاحه في النظام']);}}public function destroy(Request $request){$row=Team::find($request->id);if(!empty($row)){@unlink(self::PATH.$row->image);$row->delete();$request->session()->flash('deleteMessage','تم حذف البيانات بنجاح');return back();}return back();}}