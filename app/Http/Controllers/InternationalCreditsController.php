<?php namespace App\Http\Controllers;use App\Models\Journals;use Illuminate\Http\Request;use App\Models\InternationalCredits;class InternationalCreditsController extends Controller{const PATH="assets/uploads/international-credits/";const IMG_EXT='.webp';public function index(){$rows=InternationalCredits::with(["journal"=>function($q){$q->select("name",'id');}])->orderBy("id","DESC")->get();$journals=Journals::orderBy("id","DESC")->get();return view("admin.international-credits.all",compact("rows","journals"));}public function store(Request $request){$request->validate(['journal'=>'required','image'=>'required|mimes:jpeg,jpg,png,webp|max:10240',]);$image=$request->image;$imgName=randomName(self::IMG_EXT);$insert=InternationalCredits::create(['image'=>$imgName,'journal_id'=>$request->journal,]);if($insert->save()){image($image,self::PATH,$imgName,200,120);return response(['status'=>true,'message'=>'تم اضافة البيانات بنجاح','form'=>'reset']);}}public function destroy(Request $request){$row=InternationalCredits::find($request->id);if(!empty($row)){@unlink(self::PATH.$row->image);$row->delete();$request->session()->flash('success','تم حذف البيانات بنجاح');return back();}return back();}}