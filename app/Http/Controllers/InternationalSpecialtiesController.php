<?php namespace App\Http\Controllers;use Illuminate\Http\Request;use App\Models\InternationalTypes;use App\Models\InternationalSpecialties;class InternationalSpecialtiesController extends Controller{private function rules($request,$type=['store','update']){$ids=InternationalTypes::select('id')->get();$array_id=[];foreach($ids as $row){array_push($array_id,$row->id);}$checkField=$type=="update"?"nullable":"required";$request->validate(['specialty'=>$checkField.'|max:255','type'=>$checkField."|in:".implode(",",$array_id),]);}public function index(){$pageTitle='تخصصات النشر الدولي';$types=InternationalTypes::orderBy("id",'DESC')->get();$specialties=InternationalSpecialties::with('type')->orderBy("id",'DESC')->get();$formUrl=adminUrl('international-publishing/specialties/store');$btnText='اضافة التخصص';$id=isset($_GET['id'])?intval($_GET['id']):NULL;$row=NULL;if($id!=NULL){$row=InternationalSpecialties::with('type')->where('id',$id)->first();if(empty($row)){return redirect(adminPrefix().'/international-publishing/specialties');}else{$formUrl=adminUrl('international-publishing/specialties/update');$btnText='تحديث';}}return view("admin.international-specialties.index",compact('pageTitle','types','row','formUrl','btnText','specialties'));}public function store(Request $request){$this->rules($request);$insert=InternationalSpecialties::create(['specialty'=>$request->specialty,'type_id'=>$request->type,]);if($insert->save()){$request->session()->flash("success",'تم اضافة البيانات بنجاح');return back();}}public function update(Request $request){$id=$request->id;$row=InternationalSpecialties::find($id);if(!empty($row)){$this->rules($request,'update');$row->specialty=$request->specialty;$row->type_id=$request->type;if($row->save()){$request->session()->flash('success','تم تحديث البيانات بنجاح');return back();}}else{$request->session()->flash('error','هذه البيانات ليست متاحه في النظام');return back();}}public function destroy(Request $request){$row=InternationalSpecialties::find($request->id);if(!empty($row)){$row->delete();$request->session()->flash('success','تم حذف البيانات بنجاح');return back();}return back();}public function get_specialties_api($id){$rows=InternationalSpecialties::select('id','specialty',"type_id")->where("type_id",$id)->orderBy('id','DESC')->get();return json_decode($rows);}}